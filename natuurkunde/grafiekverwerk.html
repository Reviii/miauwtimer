<html>
<head>
<title>Grafiek verwerking</title>
<style>
.thumb {
    width: 350px;
    image-rendering: pixelated;
}
</style>
</head>
<body>
<div id="step1">
    <input type="file" id="file">Voorwaarde:<input id="condition" value="(g+b)/r>2.5"><button onclick="process()">Verwerk!</button><br>
    <img class="thumb" id="original"><img class="thumb" id="processed"><br>
    <button onclick="document.getElementById('step1').style.display='none';document.getElementById('step2').style.display='block'">Volgende stap</button>
</div>
<div id="step2" style="display: none">
    <button onclick="document.getElementById('step2').style.display='none';document.getElementById('step1').style.display='block'">Terug</button><br><br>
    Grootheid verticale as:<input value="v" size="2" oninput="unitChange('Y', this.value)"> Grootheid horizontale as:<input value="t" size="2" oninput="unitChange('X', this.value)"><br>
    <span class="unitX">t</span>Min:<input id="xMin"> <span class="unitX">t</span>Max:<input id="xMax"><br>
    <span class="unitY">v</span>Min:<input id="yMin"> <span class="unitY">v</span>Max:<input id="yMax"><br>
    Vermenigvuldig met: <span class="unitX">t</span><sup><select id="power"><option value="2">2</option><option value="1">1</option><option value="0">0</option><option value="-1" selected>-1</option><option value="-2">-2</option></select></sup>
    Resulterende grootheid:<input value="a" size="2" id="resUnit"><button>Bereken</button><br>
    <a>Origineel (csv met puntkomma's als scheidingstekens)</a><br>
    <a>Verwerkt (csv met puntkomma's als scheidingstekens)</a>
</div>
<script>
var points = [];
function handleFileSelect(evt) {
    var files = evt.target.files; // FileList object
    var f=files[0]
    if (!f.type.match('image.*')) {
      return;
    }
    document.getElementById('original').src = URL.createObjectURL(f);
    //document.getElementById('original').onload=process;
}
document.getElementById('file').addEventListener('change', handleFileSelect, false);
function process() {
    var img = document.getElementById("original");
    var c = document.createElement("canvas");
    c.width = img.naturalWidth;
    c.height = img.naturalHeight;
    var ctx = c.getContext("2d");
    ctx.drawImage(img, 0, 0);
    var imgData = ctx.getImageData(0, 0, c.width, c.height);
    var condition = new Function("r", "g", "b", "return "+document.getElementById("condition").value);
    var x = 0;
    var y = 0;
    points = [];
    for (var i=0;i<c.width;i++) {
        points[i] = [];
    }
    for (var i=0;i<imgData.data.length;i+=4) {
        if (condition(imgData.data[i+0], imgData.data[i+1], imgData.data[i+2])) {
            points[x][points[x].length] = y;
            imgData.data[i+0] = 0;
            imgData.data[i+1] = 0;
            imgData.data[i+2] = 0;
            imgData.data[i+3] = 255;
        } else {
            imgData.data[i+0] = 255;
            imgData.data[i+1] = 255;
            imgData.data[i+2] = 255;
            imgData.data[i+3] = 255;
        }
        x++;
        if (x>=c.width) {
            x = x-c.width;
            y++;
        }
    }
    ctx.putImageData(imgData, 0, 0);
    c.toBlob(function (a) { document.getElementById("processed").src = URL.createObjectURL(a); }, "image/png");
    //console.log(points);
}
function unitChange(unit, value) { // er staat unit, maar het gaat om de grootheid
    var u = document.getElementsByClassName("unit"+unit);
    for (var i=0;i<u.length;i++) {
        u[i].innerText = value;
    }
}
</script>
</body>
</html>
