<html>
<head>
<title>Grafiek verwerking</title>
<style>
.thumb {
    width: 350px;
    image-rendering: pixelated;
}
</style>
</head>
<body>
<div id="step1">
    <input type="file" id="file">Voorwaarde:<input id="condition" value="(g+b)/r>10"><button onclick="process()">Verwerk!</button><br>
    <img class="thumb" id="original"><img class="thumb" id="processed"><br>
    <button onclick="document.getElementById('step1').style.display='none';document.getElementById('step2').style.display='block'">Volgende stap</button>
</div>
<div id="step2" style="display: none">
    <button onclick="document.getElementById('step2').style.display='none';document.getElementById('step1').style.display='block'">Terug</button><br><br>
    Hoogte:<input> Breedte:<input> Eenheid op horizontale as:<input value="t"><br>
    Vermenigvuldig met: <span id="unit">t</span><sup><select id="power"><option value="2">2</option><option value="1">1</option><option value="0">0</option><option value="-1">-1</option><option value="-2">-2</option></select></sup><button>Bereken</button><br>
    <a>Origineel (csv met puntkomma's als scheidingstekens)</a><br>
    <a>Verwerkt (csv met puntkomma's als scheidingstekens)</a>
</div>
<script>
function handleFileSelect(evt) {
    var files = evt.target.files; // FileList object
    var f=files[0]
    if (!f.type.match('image.*')) {
      return;
    }
    document.getElementById('original').src = URL.createObjectURL(f);
    //document.getElementById('original').onload=process;
}
document.getElementById('file').addEventListener('change', handleFileSelect, false);
function process() {
    var img = document.getElementById("original");
    var c = document.createElement("canvas");
    c.width = img.naturalWidth;
    c.height = img.naturalHeight;
    var ctx = c.getContext("2d");
    ctx.drawImage(img, 0, 0);
    var imgData = ctx.getImageData(0, 0, c.width, c.height);
    var condition = new Function("r", "g", "b", "return "+document.getElementById("condition").value);
    var x = 0;
    var y = 0;
    for (var i=0;i<imgData.data.length;i+=4) {
        if (condition(imgData.data[i+0], imgData.data[i+1], imgData.data[i+2])) {
            //alert("X:"+x+"\nY:"+y);
            imgData.data[i+0] = 0;
            imgData.data[i+1] = 0;
            imgData.data[i+2] = 0;
            imgData.data[i+3] = 255;
        } else {
            imgData.data[i+0] = 255;
            imgData.data[i+1] = 255;
            imgData.data[i+2] = 255;
            imgData.data[i+3] = 255;
        }
        x++;
        if (x>=c.width) {
            x = x-c.width;
            y++;
        }
    }
    ctx.putImageData(imgData, 0, 0);
    c.toBlob(function (a) { document.getElementById("processed").src = URL.createObjectURL(a); }, "image/png");
}

</script>
</body>
</html>
